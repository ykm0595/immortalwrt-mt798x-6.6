name: Fetch-Upstream-OpenWrt

on:
  workflow_dispatch:     # 手动触发
  schedule:
    - cron: "0 3 * * *"  # 每天自动更新

jobs:
  fetch:
    runs-on: ubuntu-22.04

    steps:
    - name: Checkout your repo
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Remove old openwrt directory
      run: |
        rm -rf openwrt
        mkdir -p openwrt

    - name: Clone upstream OpenWrt into openwrt/
      run: |
        git clone --depth=1 https://github.com/padavanonly/immortalwrt-mt798x-6.6.git openwrt

    - name: Commit and push changes
      run: |
        git config user.name "github-actions"
        git config user.email "github-actions@github.com"

        git add openwrt
        git commit -m "Update upstream OpenWrt source" || echo "No changes to commit"

        git push origin HEAD:main
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
